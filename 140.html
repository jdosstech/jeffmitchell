<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
<title>Jeff Mitchell</title>
<style>
  :root{ --bg:#0b0d13; --card:#121629; --text:#e9ebf5; --muted:#a8afc1; --blue:#2563eb; --border:#23283b; --shadow:0 12px 40px rgba(0,0,0,.45); }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#090b12,#0f1424);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:1080px;margin:32px auto;padding:0 16px}
  header h1{margin:0 0 6px;font-size:clamp(36px, 8vw, 84px);line-height:1.05;letter-spacing:.6px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);overflow:hidden}
  .grid{display:grid;grid-template-columns:360px 1fr;gap:18px;align-items:center;padding:22px}
  .art img{width:100%;border-radius:14px;display:block}
  .title{font-size: clamp(28px, 3.2vw, 42px);font-weight:700;margin:0 0 6px}
  .alias{font-size: clamp(16px, 2.0vw, 20px);color:var(--muted);margin-bottom:12px}
  .btns{display:flex;flex-wrap:wrap;gap:14px;margin:12px 0}
  .meta{font-size:14px;color:var(--muted)}
  .controls{display:flex;justify-content:space-between;align-items:center;padding:14px 22px;border-top:1px solid var(--border)}
  .arrow{cursor:pointer;background:#fff;color:#000;border:none;border-radius:999px;width:56px;height:56px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:44px;line-height:1;}
  .dots span{display:inline-block;width:8px;height:8px;border-radius:999px;background:#3a4361;margin:0 3px}
  .dots span.active{background:var(--blue)}
  @media(max-width:880px){.grid{grid-template-columns:1fr} .art img{max-width:420px;margin:0 auto}}
  /* Base button styling */
  .btn{
    position:relative;
    display:inline-block;
    text-decoration:none;
    color:#e9ebf5;
    font-weight:600;
    line-height:1;
    padding:14px 18px;
    border-radius:12px;
    min-width:140px;
    text-align:center;
    border:1px solid #2a3250;
    background:linear-gradient(180deg,#1a2140,#111730);
    box-shadow:
      inset 0 1px 0 rgba(255,255,255,.06),
      0 2px 0 rgba(0,0,0,.6),
      0 10px 20px rgba(0,0,0,.35);
  }
  /* Slightly larger labels */
  .btn{ font-size: clamp(15px, 1.8vw, 18px); }

  /* Icons */
  .btn::before{
    display:inline-block; margin-right:8px; opacity:.9; content:'';
  }
  .btn--youtube::before{ content:'▶'; }
  .btn--music::before{ content:'♪'; }
  .btn--apple::before{ content:'♪'; }
  .btn--spotify::before{ content:'♫'; }

  /* Platform base tints (dim) */
  .btn--youtube{ background:linear-gradient(180deg,#261818,#141010); border-color:#4a1e1e; }
  .btn--music{  background:linear-gradient(180deg,#24171b,#151013); border-color:#42202c; }
  .btn--apple{  background:linear-gradient(180deg,#1c212b,#121622); border-color:#2a3145; }
  .btn--spotify{background:linear-gradient(180deg,#15231a,#0f1a13); border-color:#22402d; }

  /* Always-on crisp tiny white edge (brighter .22 outer hairline) */
  .btn{
    box-shadow:
      inset 0 0 0 1px rgba(255,255,255,.12),
      0 0 0 1px rgba(255,255,255,.22),
      0 2px 0 rgba(0,0,0,.6),
      0 10px 20px rgba(0,0,0,.35);
  }

  /* Hover/focus color + glow (per-platform) */
  .btn{ --btn-glow: rgba(79,124,255,.28); }
  .btn--youtube{ --btn-glow: rgba(239,68,68,.33); }
  .btn--music{  --btn-glow: rgba(225,29,72,.33); }
  .btn--apple{  --btn-glow: rgba(99,102,241,.33); }
  .btn--spotify{--btn-glow: rgba(34,197,94,.35); }

  .btn--youtube:hover{ background:linear-gradient(180deg,#2f1e1e,#1a1313); }
  .btn--music:hover{  background:linear-gradient(180deg,#2d1d23,#1a1316); }
  .btn--apple:hover{  background:linear-gradient(180deg,#242b39,#161b28); }
  .btn--spotify:hover{background:linear-gradient(180deg,#1c2b22,#121e17); }

  .btn:hover{
    box-shadow:
      inset 0 0 0 1px rgba(255,255,255,.12),
      0 0 0 1px rgba(255,255,255,.22),
      0 2px 0 rgba(0,0,0,.6),
      0 10px 20px rgba(0,0,0,.35),
      0 0 0 1px var(--btn-glow),
      0 0 26px var(--btn-glow),
      0 0 52px var(--btn-glow);
  }
  .btn:focus-visible{
    outline:none;
    box-shadow:
      inset 0 0 0 1px rgba(255,255,255,.12),
      0 0 0 1px rgba(255,255,255,.22),
      0 2px 0 rgba(0,0,0,.6),
      0 10px 22px rgba(0,0,0,.36),
      0 0 0 2px rgba(255,255,255,.08),
      0 0 0 4px var(--btn-glow),
      0 0 28px var(--btn-glow);
  }

  /* Micro scale-up for tactility */
  @media (prefers-reduced-motion: no-preference){
    .btn{ transition: transform .08s ease, box-shadow .12s ease; }
    .btn:hover{ transform: scale(1.03); }
    .btn:focus-visible{ transform: scale(1.02); }
    .btn:active{ transform: translateY(1px) scale(0.995); }
  }

/* Touch friendliness */
* { -webkit-tap-highlight-color: rgba(0,0,0,0); }
@supports(padding:max(0px)){
  body{ padding-left: max(0px, env(safe-area-inset-left)); padding-right: max(0px, env(safe-area-inset-right)); }
}
/* On pure touch, keep buttons static (no hover transform), keep focus gentle */
@media (hover: none) and (pointer: coarse){
  .btn:hover{ transform:none !important; }
  .btn:focus-visible{ transform:none !important; }
}


/* === All Songs index (stable + tiny grid) === */
.grid.full { grid-template-columns: 1fr; }
.grid.full .art{ display:none; }
.grid.full .info{ grid-column: 1 / -1; }
.card.allpage{ overflow-y:auto; max-height: calc(100vh - 160px); }
.thumb-grid{ display:grid; grid-template-columns: repeat(9, 72px); gap:6px; justify-content:flex-start; }
.thumb-btn{ border:1px solid var(--border); background:var(--card); border-radius:10px; padding:0; width:72px; height:72px; overflow:hidden; cursor:pointer; box-shadow:var(--shadow); }
.thumb-btn img{ width:100%; height:100%; object-fit:cover; display:block; }
@media (max-width: 900px){
  .thumb-grid{ grid-template-columns: repeat(6, 64px); gap:6px; }
  .thumb-btn{ width:64px; height:64px; }
}
@media (max-width: 640px){
  .thumb-grid{ grid-template-columns: repeat(4, 56px); gap:6px; }
  .thumb-btn{ width:56px; height:56px; }
}

/* --- Media-style arrows (rewind/fast-forward) --- */
.arrow{ font-size:0; } /* hide any fallback glyph spacing */
.arrow .icon{ width:32px; height:32px; display:block; }
.arrow .icon polygon{ fill: currentColor; }
.arrow:hover .icon{ transform: scale(1.08); }
.arrow .icon{ transition: transform 140ms ease; }

/* Rotate left arrow 180deg */
#prev .icon{ transform: rotate(180deg); }
#prev:hover .icon{ transform: rotate(180deg) scale(1.08); }

/* ultra-robust hide of pagination dots */
.dots{ display:none !important; height:0 !important; overflow:hidden !important; pointer-events:none !important; }

</style>
</head>
<body>
<!-- Floating Apple button OUTSIDE the swipe/transform container -->
<div id="floating-apple-wrap" style="position:fixed;left:0;right:0;bottom:calc(env(safe-area-inset-bottom, 0) + 8px);z-index:2147483647;display:flex;justify-content:center;pointer-events:auto;">
  <div style="padding:12px calc(env(safe-area-inset-right, 0) + 12px) calc(env(safe-area-inset-bottom, 0) + 12px) calc(env(safe-area-inset-left, 0) + 12px);">
    <a id="floating-apple-btn" href="#" 
       style="pointer-events:auto;display:inline-block;padding:12px 18px;background:#111;color:#fff;border-radius:12px;text-decoration:none;font-weight:600;box-shadow:0 6px 18px rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.08)">
       Apple Music
    </a>
  </div>
</div>

<!-- Dynamic Apple toolbar (outside carousel) -->
<!-- STATIC TEST LINK: mirrors diag #1 behavior -->
<div class="wrap">
<header><h1>Jeff Mitchell</h1></header>
<div class="card">
<div class="grid">
<div class="art"><img alt="artwork" decoding="async" id="artwork" loading="eager"/></div>
<div class="info">
<div class="title" id="title"></div>
<div class="alias" id="alias"></div>
<div class="btns" id="btns"></div>
<div class="meta" id="meta"></div>
</div>
</div>
<div class="controls">
<button aria-label="Previous" class="arrow" id="prev">
<svg aria-hidden="true" class="icon" focusable="false" viewbox="0 0 48 24">
<polygon points="22,12 10,20 10,4"></polygon>
<polygon points="38,12 26,20 26,4"></polygon>
</svg>
</button>
<div class="dots" id="dots"></div>
<button aria-label="Next" class="arrow" id="next">
<svg aria-hidden="true" class="icon" focusable="false" viewbox="0 0 48 24">
<polygon points="10,4 22,12 10,20"></polygon>
<polygon points="26,4 38,12 26,20"></polygon>
</svg>
</button>
</div>
</div>
</div>
<script>
const songs = [
  {
  title: "Morning Bloom",
  alias: "llehciM ffeJ",
  image: "assets/a77d5e5e-d23a-416b-9437-a9ac2a75aebc.png",
  links: {}
},
  {
  title: "Empty Pulpit",
  alias: "llehciM ffeJ",
  image: "assets/f3549da5-fdeb-419a-972e-d4db3d442319.png",
  links: {}
},
  {
  title: "1L1L",
  alias: "Musikologist",
  image: "assets/534ed1b5-3f7e-46f7-a7f5-d13169f0d438.png",
  links: {}
},
  {
  title: "pmurT",
  alias: "llehciM ffeJ",
  image: "assets/b9c57713-68b0-428b-9451-64bddd4a1381.png",
  links: {}
},
  {
  title: "Hobo",
  alias: "Jeff Mitchell",
  image: "assets/e1afe1b0-7aa8-4ecf-ba4a-71bcadf9f255.png",
  links: {}
},
  {
  title: "Glump",
  alias: "llehciM ffeJ",
  image: "assets/e02f5653-e2c7-4e78-81fc-6ab0dcc5fbfd.png",
  links: {}
},
  {
  title: "News Today #1",
  alias: "llehciM ffeJ",
  image: "assets/76d2e3da-7f2e-4229-8f3f-880c2bb57240.png",
  links: {}
},
  {
  title: "Whatitle 2",
  alias: "Jeff Mitchell",
  image: "assets/ea3bacf2-669e-4c30-9c7c-38e52d210da3.png",
  links: { }},
  {
  title: "Whatitle",
  alias: "Jeff Mitchell",
  image: "assets/5c07ecc1-0306-4ab4-af1c-ac030f95c5f7.png",
  links: { }},
  {
  title: "Smorgas Drums",
  alias: "llehciM ffeJ",
  image: "assets/d51fc5dc-fe8f-44bd-8d44-bb9385872dd7.png",
  links: {}
},
  {
  title: "I Really Don't Know",
  alias: "Jeff Mitchell",
  image: "assets/e919cce3-bb92-4c31-9452-6c41812aa47d.png",
  links: {}
},
  {
  title: "Eleven nevelE",
  alias: "Musikologist",
  image: "assets/e26396ab-2e72-4493-90d1-a70130eb02e3.png",
  links: {}
},
  {
  title: "Tugboat Love",
  alias: "Musikologist",
  image: "assets/c45e726d-f9f1-4237-b796-6612199c0707.png",
  links: {}
},
  {
  title: "ACDCCDCA",
  alias: "llehciM ffeJ",
  image: "assets/d341ecfc-6c3c-49b8-bb95-190fde74d01c.png",
  links: {}
},
  {
  title: "Hi Yi Yi Yi",
  alias: "llehciM ffeJ",
  image: "assets/1b4ded4e-cca7-4aba-b693-9a8522169cae.png",
  links: {}
},
  {
  title: "The Silence",
  alias: "Jeff Mitchell",
  image: "assets/2ec610f2-efb2-4852-89b2-4e2cb1dde9da.png",
  links: {}
},
  {
  title: "Pew Pe Pe Pew",
  alias: "llehciM ffeJ",
  image: "assets/7723a7cb-3118-4643-a4c3-00ed053a5ff3.png",
  links: {}
},
  {
  title: "Scum Bum",
  alias: "Jeff Mitchell",
  image: "assets/c7ffafb4-f1a0-45aa-93bc-9eac5a94be9d.png",
  links: {}
},
  {
  title: "Poppies Whisper in Color",
  alias: "Jeff Mitchell",
  image: "assets/c4fa0f8c-9ce7-4cef-8792-43e25a469e6c.png",
  links: {}
},
  {
  title: "Experimental Blues",
  alias: "Jeff Mitchell",
  image: "assets/4f88e1f7-0b7b-4613-87b1-8e06fe4df2f9.png",
  links: {}
},
  {
  title: "Zombey",
  alias: "llehciM ffeJ",
  image: "assets/6dea58b4-7c99-4d5b-b51d-12cdfba9856a.png",
  links: {}
},
  {
  title: "Crapola? (Sharada Remix)",
  alias: "Jeff Mitchell",
  image: "assets/c785b1cc-fb77-494e-9f11-9af10482cc0e.png",
  links: {}
},
  {
  title: "Leef feeL",
  alias: "llehciM ffeJ",
  image: "assets/d535c24c-44d6-4062-b854-b59ea6bd8618.png",
  links: {}
},
  {
  title: "Bom Bom Bom",
  alias: "Jeff Mitchell",
  image: "assets/0d68bc86-05f8-4204-a109-a85a4239486b.png",
  links: {}
},
  {
  title: "Bus Stop",
  alias: "llehciM ffeJ",
  image: "assets/69b55390-e959-4c88-9e28-946f45dd104f.png",
  links: {}
},
  {
  title: "quit",
  alias: "llehciM ffeJ",
  image: "assets/632ceb88-b358-4f58-9539-188987fd8ebe.png",
  links: {}
},
  {
  title: "Anders-Jam",
  alias: "Jeff Mitchell",
  image: "assets/0357f981-758b-40ea-a80f-7a8d425aeef8.png",
  links: {}
},
  {
  title: "Cold Coffee and Slow Rain",
  alias: "llehciM ffeJ",
  image: "assets/76ccd356-622d-4690-8652-6aaf28f66932.png",
  links: {}
},
  {
  title: "Smooth Electro-Symphony",
  alias: "Musikologist",
  image: "assets/9f922d55-b744-4412-a3f8-ed9074f56368.png",
  links: {}
},
  {
  title: "Dim Jazz",
  alias: "Musikologist",
  image: "assets/7c41d629-5e2f-4966-ba14-832372ddd31d.png",
  links: {}
},
  {
  title: "Missing You",
  alias: "Musikologist",
  image: "assets/01585b93-7d02-4a04-b353-028084335333.png",
  links: {}
},
  {
  title: "Ded Blues",
  alias: "Jeff Mitchell",
  image: "assets/25937e71-2040-476b-80c4-89503c0e4c33.png",
  links: {}
},
  {
  title: "Rain Mantra",
  alias: "Musikologist",
  image: "assets/77375d9d-b85a-45e5-b9da-ec0569c99827.png",
  links: {}
},
  {
  title: "LA Gangsters",
  alias: "Musikologist",
  image: "assets/0ec22b71-3128-4dbb-a0fa-8d0b5d646004.png",
  links: {}
},
  {
  title: "Upbeat Blues",
  alias: "Musikologist",
  image: "assets/f2ac06f5-a7a1-46ab-bc01-69cefa7fe018.png",
  links: {}
},
  {
  title: "Slow Night",
  alias: "Musikologist",
  image: "assets/868f4d2c-2d1b-4a45-bc61-943dcec3cdb4.png",
  links: {}
},
  {
  title: "Night Time",
  alias: "Musikologist",
  image: "assets/e743572f-000e-4131-8951-7fa40e95d1ae.png",
  links: {}
},
  {
  title: "Awoke With My Love Beside Me",
  alias: "Musikologist",
  image: "assets/7b836653-0c72-46b8-b2fe-dcab00913df0.png",
  links: {}
},
  {
  title: "Evening Jazz",
  alias: "Musikologist",
  image: "assets/078243a5-5922-489b-a764-ad1122b3523c.png",
  links: {}
},
  {
  title: "All In One Take, Seriously",
  alias: "Jeff Mitchell",
  image: "assets/all-in-one-take-seriously.png",
  links: { }
},
  {
  title: "Exact Timing",
  alias: "Musikologist",
  image: "assets/exact-timing.png",
  links: { }
},
  {
  title: "Country Rockin' (It'll Make Ya Yeee-Haaaw)",
  alias: "Musikologist",
  image: "assets/country-rockin-yee-haaaw.png",
  links: { }
},
  {
  title: "My Time In The Jungle",
  alias: "Musikologist",
  image: "assets/my-time-in-the-jungle.png",
  links: { }
},
  {
  title: "Aboriginal",
  alias: "Musikologist",
  image: "assets/aboriginal.png",
  links: { }
},
  {
  title: "Atmospheric",
  alias: "Musikologist",
  image: "assets/atmospheric.png",
  links: { }
},
];

// Build search links if exact links missing
function buildPlatformLinks(song){
  var q = encodeURIComponent((song.title + ' ' + song.alias).trim());
  return {
    youtube: song.links && song.links.youtube ? song.links.youtube : 'https://www.youtube.com/results?search_query=' + q,
    music:   song.links && song.links.music   ? song.links.music   : 'https://music.youtube.com/search?q=' + q,
    apple:   song.links && song.links.apple   ? song.links.apple   : 'https://music.apple.com/us/search?term=' + q,
    spotify: song.links && song.links.spotify ? song.links.spotify : 'https://open.spotify.com/search/' + q
  };
}

// Image path with fallback to ./assets
function setArtImage(imgEl, s){
  var filename = (s.image || '').split('/').pop();
  var candidates = ['assets/'+filename, './assets/'+filename];
  var idx = 0; function tryNext(){ if (idx>=candidates.length) return; imgEl.src=candidates[idx++]; }
  imgEl.onerror = tryNext; tryNext();
}

// Neighbor-only preloading: current + immediate neighbors
function preloadNeighbors(index){
  function warm(i){
    if (i < 0 || i >= songs.length) return;
    var s = songs[i]; if (!s || !s.image) return;
    var img = new Image(); img.decoding='async'; img.loading='lazy';
    var filename = (s.image || '').split('/').pop();
    var candidates = ['assets/'+filename, './assets/'+filename];
    var j=0; img.onerror=function(){ if(++j<candidates.length) img.src=candidates[j]; };
    img.src=candidates[0];
  }
  warm(index-1); warm(index+1);
}

var app = {
  i:0,
  el:{art:document.getElementById('artwork'), title:document.getElementById('title'), alias:document.getElementById('alias'), btns:document.getElementById('btns'), meta:document.getElementById('meta'), dots:document.getElementById('dots')},
  init:function(){
    this.bind(); this.render();
    (window.requestIdleCallback ? requestIdleCallback : setTimeout)(function(){ preloadNeighbors(app.i); }, 0);
  },
  bind:function(){
    document.getElementById('prev').addEventListener('click', function(){ app.i=(app.i-1+songs.length)%songs.length; app.render(); preloadNeighbors(app.i); });
    document.getElementById('next').addEventListener('click', function(){ app.i=(app.i+1)%songs.length; app.render(); preloadNeighbors(app.i); });
    // Keyboard navigation
    document.addEventListener('keydown', function(e){
      var tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : '';
      if (tag === 'input' || tag === 'textarea' || e.isComposing) return;
      if (e.key === 'ArrowLeft' || e.key === 'Left'){ e.preventDefault(); document.getElementById('prev').click(); }
      else if (e.key === 'ArrowRight' || e.key === 'Right'){ e.preventDefault(); document.getElementById('next').click(); }
    });
  },
  render:function(){
    var s=songs[this.i]; if(!s) return;
    setArtImage(this.el.art, s);
    this.el.art.alt = s.title + ' — artwork';
    this.el.title.textContent = s.title;
    this.el.alias.textContent = s.alias || '';
    var urls=buildPlatformLinks(s);
    var labels={youtube:'YouTube', music:'YT Music', apple:'Apple Music', spotify:'Spotify'};
    this.el.btns.innerHTML='';
    Object.keys(labels).forEach(function(k){ var a=document.createElement('a'); a.className='btn btn--'+k; a.href=urls[k]; a.target='_blank'; a.rel='noopener'; a.textContent=labels[k]; app.el.btns.appendChild(a); });
    this.el.meta.textContent = (this.i+1) + ' / ' + songs.length + ' · neighbor-only loading';
    this.el.dots.innerHTML='';
    songs.forEach(function(_,idx){ var d=document.createElement('span'); d.className=(idx===app.i?'active':''); d.addEventListener('click',function(){ app.i=idx; app.render(); preloadNeighbors(app.i); }); app.el.dots.appendChild(d); });
  }
};

// Splash overlay: hide when first image loads or after 3s fallback
(function(){
  function hideOverlay(){ var o=document.getElementById(''); if (o) o.style.display='none'; }
  var art = document.getElementById('artwork');
  if (art && art.complete) hideOverlay(); else if (art) art.addEventListener('load', hideOverlay, { once:true });
  setTimeout(hideOverlay, 3000);
})();

// iOS :active primer so :active styles fire
document.addEventListener('touchstart', function(){}, {passive:true});


/* --- Ultra-robust dots killer --- */
(function(){
  function kill(){
    var d = document.getElementById('dots');
    if (!d) return;
    d.innerHTML = '';
    d.style.display = 'none';
    d.style.height = '0';
    d.style.overflow = 'hidden';
    d.style.pointerEvents = 'none';
  }
  function observe(){
    var d = document.getElementById('dots');
    if (!d) return;
    var mo = new MutationObserver(kill);
    mo.observe(d, { childList:true, subtree:true, attributes:true });
    kill();
  }
  if (window.app && typeof app.render === 'function'){
    var _r = app.render.bind(app);
    app.render = function(){ _r(); observe(); };
    setTimeout(observe, 0);
  } else {
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(observe, 50); });
  }
})();
/* --- end dots killer --- */


/* --- Button targets & iPad tap handling --- */
(function(){
  function isIOS(){ var ua=navigator.userAgent||navigator.vendor||""; return /iPad|iPhone|iPod/.test(ua) || (ua.includes("Mac") && "ontouchend" in document); }
  function apply(){
    var b = document.getElementById('btns'); if (!b) return;
    b.style.touchAction = 'manipulation';
    b.addEventListener('touchstart', function(e){ e.stopPropagation(); }, {passive:true});
    b.addEventListener('click', function(e){ e.stopPropagation(); }, false);
    Array.from(b.querySelectorAll('a')).forEach(function(a){
      if (/Apple Music/i.test(a.textContent||'')){
        if (isIOS()){ a.target = '_self'; a.rel = 'external'; }
        else { a.target = '_blank'; a.rel = 'noopener'; }
      } else {
        a.target = '_blank'; a.rel = 'noopener';
      }
    });
  }
  if (window.app && typeof app.render === 'function'){
    var _r = app.render.bind(app);
    app.render = function(){ _r(); apply(); };
    setTimeout(apply, 0);
  } else {
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(apply, 50); });
  }
})();
/* --- end targets --- */

/* --- Apple anchor hardening: strip handlers, plain <a> with exact href --- */
(function(){
  function hardenAppleAnchor(){
    var btns = document.getElementById('btns'); if (!btns) return;
    var apple = Array.from(btns.querySelectorAll('a')).find(a => /Apple Music/i.test(a.textContent||""));
    if (!apple) return;

    // Use the href already in the DOM (should be the exact track link from songs.links.apple)
    var href = apple.getAttribute('href') || "";
    if (!/^https?:\/\/music\.apple\.com/i.test(href)){
      // normalize any variant to canonical
      href = href.replace(/^http:\/\//i, "https://")
                 .replace(/^https?:\/\/open\.music\.apple\.com/i, "https://music.apple.com")
                 .replace(/^https?:\/\/embed\.music\.apple\.com/i, "https://music.apple.com");
    }

    // Clone to drop any attached listeners
    var clean = apple.cloneNode(true);
    clean.setAttribute('href', href);
    clean.setAttribute('target', '_blank');
    clean.setAttribute('rel', 'noopener');
    clean.onclick = null; // ensure no custom click
    clean.onmouseup = null;
    clean.onmousedown = null;
    clean.ontouchstart = null;
    clean.ontouchend = null;

    // Prevent parent swipe from hijacking the gesture
    clean.addEventListener('touchstart', function(e){ e.stopPropagation(); }, {passive:true});
    clean.addEventListener('click', function(e){ e.stopPropagation(); }, false);

    apple.replaceWith(clean);

    // Make sure wrapper allows clicks
    btns.style.pointerEvents = 'auto';
    btns.style.touchAction = 'manipulation';
  }

  if (window.app && typeof app.render === 'function'){
    var _r = app.render.bind(app);
    app.render = function(){ _r(); hardenAppleAnchor(); };
    // and on first paint
    setTimeout(hardenAppleAnchor, 0);
  } else {
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(hardenAppleAnchor, 50); });
  }
})();
/* --- end hardening --- */


/* --- Dynamic Apple toolbar updater (iOS=_self+external, Desktop=_blank+noopener) --- */
(function(){
  function isIOS(){
    var ua = navigator.userAgent || navigator.vendor || "";
    return /iPad|iPhone|iPod/.test(ua) || (ua.includes("Mac") && "ontouchend" in document);
  }
  function normalize(h){
    if (!h) return h;
    h = h.replace(/^http:\/\//i, "https://");
    h = h.replace(/^https?:\/\/open\.music\.apple\.com/i, "https://music.apple.com");
    h = h.replace(/^https?:\/\/embed\.music\.apple\.com/i, "https://music.apple.com");
    h = h.replace(/^\/\/music\.apple\.com/i, "https://music.apple.com");
    return h;
  }
  function buildFallback(title, artist){
    var q = encodeURIComponent((title + " " + (artist||"")).trim());
    return "https://music.apple.com/us/search?term=" + q;
  }
  function updateToolbar(){
    try{
      var a = document.getElementById('apple-dyn-link');
      if (!a || !window.app || !Array.isArray(window.songs)) return;
      var s = window.songs[window.app.i];
      if (!s) return;
      var href = (s.links && s.links.apple) ? s.links.apple : buildFallback(s.title, s.alias);
      href = normalize(href);
      a.href = href;
      a.textContent = "▶︎ Apple Music — " + (s.title || "track");
      // iOS: same tab + rel=external to trigger app handoff; Desktop: new tab
      if (isIOS()){
        a.setAttribute('target','_self');
        a.setAttribute('rel','external');
        a.onclick = null; // allow default
      } else {
        a.setAttribute('target','_blank');
        a.setAttribute('rel','noopener');
      }
    }catch(_){}
  }
  if (window.app && typeof app.render === 'function'){
    var _r = app.render.bind(app);
    app.render = function(){ _r(); updateToolbar(); };
    setTimeout(updateToolbar, 0);
  } else {
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(updateToolbar, 50); });
  }
})();
/* --- end dynamic toolbar patch --- */


/* --- Floating Apple button controller (outside swipe) --- */
(function(){
  function isIOS(){
    var ua = navigator.userAgent || navigator.vendor || "";
    return /iPad|iPhone|iPod/.test(ua) || (ua.includes("Mac") && "ontouchend" in document);
  }
  function normalize(h){
    if (!h) return h;
    h = h.replace(/^http:\/\//i, "https://");
    h = h.replace(/^https?:\/\/open\.music\.apple\.com/i, "https://music.apple.com");
    h = h.replace(/^https?:\/\/embed\.music\.apple\.com/i, "https://music.apple.com");
    h = h.replace(/^\/\/music\.apple\.com/i, "https://music.apple.com");
    return h;
  }
  function buildFallback(title, artist){
    var q = encodeURIComponent((title + " " + (artist||"")).trim());
    return "https://music.apple.com/us/search?term=" + q;
  }
  function currentSong(){
    if (!window.app || !Array.isArray(window.songs)) return null;
    return window.songs[window.app.i] || null;
  }
  function apply(){
    var btn = document.getElementById('floating-apple-btn'); if (!btn) return;
    var s = currentSong(); if (!s) return;
    var href = (s.links && s.links.apple) ? s.links.apple : buildFallback(s.title, s.alias);
    href = normalize(href);
    btn.setAttribute('href', href);
    // iPad/iOS: same-tab + external to trigger Music app handoff
    if (isIOS()){
      btn.setAttribute('target','_self');
      btn.setAttribute('rel','external');
      btn.onclick = null;
    } else {
      btn.setAttribute('target','_blank');
      btn.setAttribute('rel','noopener');
    }
    btn.textContent = " Apple Music — " + (s.title || "track");
  }
  if (window.app && typeof app.render === 'function'){
    var _r = app.render.bind(app);
    app.render = function(){ _r(); apply(); };
    setTimeout(apply, 0);
  } else {
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(apply, 50); });
  }
})();
/* --- end floating Apple controller --- */

/* --- Hide in-card Apple anchor on iOS to avoid confusion --- */
(function(){
  function isIOS(){
    var ua = navigator.userAgent || navigator.vendor || "";
    return /iPad|iPhone|iPod/.test(ua) || (ua.includes("Mac") && "ontouchend" in document);
  }
  function hideInCardApple(){
    if (!isIOS()) return;
    var btns = document.getElementById('btns'); if (!btns) return;
    var appleA = Array.from(btns.querySelectorAll('a')).find(a => /Apple Music/i.test(a.textContent||""));
    if (appleA){
      appleA.style.opacity = '0.25';
      appleA.style.pointerEvents = 'none';
      appleA.title = "Use the Apple button at the bottom on iPad";
    }
  }
  if (window.app && typeof app.render === 'function'){
    var _r = app.render.bind(app);
    app.render = function(){ _r(); hideInCardApple(); };
    setTimeout(hideInCardApple, 0);
  } else {
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(hideInCardApple, 50); });
  }
})();
/* --- end hide in-card Apple on iOS --- */
// Swipe navigation (left/right) on the whole card area
(function(){
  var root = document.querySelector('.card') || document.body;
  var x0=null, y0=null, t0=0;
  var SWIPE_X = 40;   // min horizontal px to count
  var SWIPE_Y = 30;   // max vertical deviation
  var SWIPE_MS = 600; // max gesture time

  root.addEventListener('touchstart', function(e){
    var t = e.changedTouches && e.changedTouches[0];
    if(!t) return;
    x0 = t.clientX; y0 = t.clientY; t0 = Date.now();
  }, {passive:true});

  root.addEventListener('touchend', function(e){
    var t = e.changedTouches && e.changedTouches[0];
    if(!t || x0===null) return;
    var dx = t.clientX - x0, dy = t.clientY - y0, dt = Date.now()-t0;
    var horiz = Math.abs(dx) >= SWIPE_X && Math.abs(dy) <= SWIPE_Y && dt <= SWIPE_MS;
    if(horiz){
      if(dx < 0){ // swipe left -> next
        var n = document.getElementById('next'); if(n) n.click();
      }else{ // swipe right -> prev
        var p = document.getElementById('prev'); if(p) p.click();
      }
    }
    x0 = y0 = null;
  }, {passive:true});
})();

// Tap artwork to go next (helps on iPad)
(function(){
  var art = document.querySelector('.art');
  if (art){
    art.addEventListener('click', function(){
      var n = document.getElementById('next'); if(n) n.click();
    }, {passive:true});
  }
})();

document.addEventListener('DOMContentLoaded',function(){ app.init(); });

// --- Robust overlay dismiss for iPad & touch ---
(function(){
  function hideOverlay(){ var o=document.getElementById(''); if(o){ o.style.display='none'; o.setAttribute('aria-hidden','true'); } }
  // Click/tap to dismiss
  var ov = document.getElementById('');
  if (ov){ ov.addEventListener('click', hideOverlay, { once:true }); }
  // Dismiss on image load OR error
  var art = document.getElementById('artwork');
  if (art){
    art.addEventListener('load', hideOverlay, { once:true });
    art.addEventListener('error', hideOverlay, { once:true });
  }
  // Hard fallback after DOM ready
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(hideOverlay, 1200); }, { once:true });
  } else {
    setTimeout(hideOverlay, 1200);
  }
})();
</script>
<script>
(function(){
  if (window.__allPageAdded) return;
  window.__allPageAdded = true;

  // Add virtual "All Songs" page as last (dedupe if present)
  for (var i=songs.length-1; i>=0; i--){
    if (songs[i] && songs[i].__all_page__ === true){ songs.splice(i,1); }
  }
  songs.push({ title:"All Songs", alias:"", image:"", links:{}, __all_page__:true });

  function thumbFrom(img){
    try{
      var f = (img||'').split('/').pop().replace(/\.[^.]+$/, '');
      return 'assets/thumbs/' + f + '.webp';
    }catch(e){ return img||''; }
  }

  var oldRender = app.render;
  app.render = function(){
    var s = songs[this.i];
    var gridEl = document.querySelector('.grid');
    var cardEl = document.querySelector('.card');

    if (s && s.__all_page__ === true){
      if (gridEl) gridEl.classList.add('full');
      if (cardEl) cardEl.classList.add('allpage');

      this.el.title.textContent = s.title;
      this.el.alias.textContent = '';

      var base = songs.filter(function(x){ return !x.__all_page__; });

      this.el.btns.innerHTML = '';
      var g = document.createElement('div');
      g.className = 'thumb-grid';

      base.forEach(function(tr, idx){
        var b = document.createElement('button');
        b.className = 'thumb-btn';
        b.type = 'button';
        var im = document.createElement('img');
        im.alt = tr.title; im.decoding='async'; im.loading='lazy';
        im.src = thumbFrom(tr.image) || tr.image || '';
        im.onerror = function(){ this.onerror=null; this.src = tr.image || ''; };
        b.appendChild(im);
        b.addEventListener('click', function(){
          app.i = idx;
          if (gridEl) gridEl.classList.remove('full');
          if (cardEl) cardEl.classList.remove('allpage');
          app.render();
          preloadNeighbors(app.i);
        });
        g.appendChild(b);
      });

      this.el.btns.appendChild(g);
      this.el.meta.textContent = (this.i+1) + ' / ' + songs.length + ' · tap any cover to jump';

      this.el.dots.innerHTML='';
      var self=this;
      songs.forEach(function(_, idx){
        var d = document.createElement('button');
        d.className = 'dot' + (idx===self.i ? ' active' : '');
        d.type='button';
        d.addEventListener('click', function(){ self.i=idx; self.render(); preloadNeighbors(self.i); });
        self.el.dots.appendChild(d);
      });
      return;
    }

    if (gridEl) gridEl.classList.remove('full');
    if (cardEl) cardEl.classList.remove('allpage');
    return oldRender.call(this);
  };

  try { app.render(); } catch(e){}
})();
</script>
<script>
(function(){
  window.__titleSwapApplied = 'v4';

  function pickPersona(ctx, s){
    // Try #meta text (often near the bottom), then #alias, then any non-empty text inside .info
    var metaEl = document.getElementById('meta');
    var aliasEl = document.getElementById('alias');
    var infoEl  = document.querySelector('.info');

    var cands = [];
    if (metaEl && metaEl.textContent) cands.push(metaEl.textContent.trim());
    if (aliasEl && aliasEl.textContent) cands.push(aliasEl.textContent.trim());
    if (infoEl){
      // Grab text nodes from children except .title
      Array.from(infoEl.childNodes).forEach(function(n){
        if (n.nodeType === 3){ // text node
          var t = (n.textContent||'').trim();
          if (t) cands.push(t);
        } else if (n.nodeType === 1 && !n.classList.contains('title')){
          var t = (n.textContent||'').trim();
          if (t) cands.push(t);
        }
      });
    }

    // Clean and choose: not empty, not identical to song title, reasonable length
    cands = cands
      .map(function(t){ return t.replace(/\s+/g,' ').trim(); })
      .filter(function(t){ return t && t.toLowerCase() !== (s.title||'').toLowerCase() && t.length <= 60; });

    // Prefer the first that looks like "two words" (could be reversed like 'llehciM ffeJ')
    var twoWord = cands.find(function(t){ return /\b[A-Za-z]{2,}\b\s+\b[A-Za-z]{2,}\b/.test(t); });
    return twoWord || cands[0] || (s.alias || s.title || '');
  }

  function applyTitles(ctx){
    var s = window.songs && ctx ? songs[ctx.i] : null;
    var header = document.querySelector('header h1');
    if (!s){
      if (header) header.textContent = 'All Songs';
      return;
    }
    if (s.__all_page__){
      if (header) header.textContent = 'All Songs';
      return;
    }

    // Pick persona EXACTLY as shown in the lower section (no normalization)
    var persona = pickPersona(ctx, s);

    if (ctx && ctx.el){
      if (ctx.el.title) ctx.el.title.textContent = persona;
      if (ctx.el.alias) ctx.el.alias.textContent = s.title;
    }
    if (header) header.textContent = persona;
  }

  function tryPatch(){
    if (!window.app || !window.songs || typeof app.render !== 'function') return false;
    var base = app.render;
    app.render = function(){
      var out = base.apply(this, arguments);
      try { applyTitles(this); } catch(e){}
      return out;
    };
    try { applyTitles(app); } catch(e){}
    return true;
  }

  if (!tryPatch()){
    document.addEventListener('DOMContentLoaded', tryPatch, {once:true});
    setTimeout(tryPatch, 150);
  }
})();

/* --- Floating Apple button: raise z-index, enable clicks, stop swipe interception --- */
(function(){
  function isIOS(){
    var ua = navigator.userAgent || navigator.vendor || "";
    return /iPad|iPhone|iPod/.test(ua) || (ua.includes("Mac") && "ontouchend" in document);
  }
  function wire(){
    var wrap = document.getElementById('floating-apple-wrap');
    var btn = document.getElementById('floating-apple-btn');
    if (!wrap || !btn) return;
    // Make sure wrapping container accepts taps and is above everything
    wrap.style.pointerEvents = 'auto';
    wrap.style.zIndex = '2147483647';
    // Anchor: ensure it captures the gesture before any global handlers
    function capture(e){ e.stopImmediatePropagation(); } // don't preventDefault
    btn.addEventListener('touchstart', capture, true);
    btn.addEventListener('touchend', capture, true);
    btn.addEventListener('click', capture, true);
    // Also stop bubbling afterwards
    btn.addEventListener('click', function(e){ e.stopPropagation(); }, false);
    btn.addEventListener('touchend', function(e){ e.stopPropagation(); }, false);
    // iOS handoff in same tab; desktop new tab is set elsewhere
    if (isIOS()){
      btn.setAttribute('target','_self');
      btn.setAttribute('rel','external');
    } else {
      btn.setAttribute('target','_blank');
      btn.setAttribute('rel','noopener');
    }
  }
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(wire, 50); });
  } else {
    setTimeout(wire, 0);
  }
})();
/* --- end floating button wiring --- */

/* --- Harden floating Apple href (no '#', always a real Apple URL) --- */
(function(){
  var MORNING_BLOOM_URL = "https://music.apple.com/us/album/morning-bloom/1840199864?i=1840199865";
  function isIOS(){
    var ua = navigator.userAgent || navigator.vendor || "";
    return /iPad|iPhone|iPod/.test(ua) || (ua.includes("Mac") && "ontouchend" in document);
  }
  function norm(h){
    if (!h) return h;
    h = h.replace(/^http:\/\//i, "https://");
    h = h.replace(/^https?:\/\/open\.music\.apple\.com/i, "https://music.apple.com");
    h = h.replace(/^https?:\/\/embed\.music\.apple\.com/i, "https://music.apple.com");
    h = h.replace(/^\/\/music\.apple\.com/i, "https://music.apple.com");
    return h;
  }
  function buildFallback(title, artist){
    var q = encodeURIComponent((title + " " + (artist||"")).trim());
    return "https://music.apple.com/us/search?term=" + q;
  }
  function currentSong(){
    try{
      if (!window.app || !Array.isArray(window.songs)) return null;
      return window.songs[window.app.i] || null;
    }catch(_){ return null; }
  }
  function computeHref(){
    var s = currentSong();
    var href = null;
    if (s && s.links && s.links.apple) href = s.links.apple;
    else if (s) href = buildFallback(s.title, s.alias);
    href = norm(href);
    // If we somehow don't have a real Apple URL, force-set Morning Bloom so at least test path works
    if (!href || !/^https:\/\/music\.apple\.com/i.test(href)) href = MORNING_BLOOM_URL;
    return href;
  }
  function apply(){
    var btn = document.getElementById('floating-apple-btn'); if (!btn) return;
    var href = computeHref();
    btn.setAttribute('href', href);
    if (isIOS()){
      btn.setAttribute('target','_self');
      btn.setAttribute('rel','external');
      btn.onclick = function(e){ /* force same-tab nav */ window.location.href = href; };
    } else {
      btn.setAttribute('target','_blank');
      btn.setAttribute('rel','noopener');
      btn.onclick = null;
    }
    // Update label
    try{
      var s = currentSong();
      btn.textContent = " Apple Music");
    }catch(_){}
  }
  // Retry until we have a real apple URL in place
  function ensureReady(){
    var tries = 0;
    var id = setInterval(function(){
      tries++;
      apply();
      var btn = document.getElementById('floating-apple-btn');
      var ok = btn && /^https:\/\/music\.apple\.com/.test(btn.getAttribute('href')||"");
      if (ok || tries > 20){ clearInterval(id); }
    }, 200);
  }
  if (window.app && typeof app.render === 'function'){
    var _r = app.render.bind(app);
    app.render = function(){ _r(); ensureReady(); };
    setTimeout(ensureReady, 0);
  } else {
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(ensureReady, 50); });
  }
})();
/* --- end harden floating Apple href --- */

/* --- Device-specific Apple behavior: iOS uses floating button; desktop uses in-card link --- */
(function(){
  function isIOS(){
    var ua = navigator.userAgent || navigator.vendor || "";
    return /iPad|iPhone|iPod/.test(ua) || (ua.includes("Mac") && "ontouchend" in document);
  }
  function norm(h){
    if (!h) return h;
    h = h.replace(/^http:\/\//i, "https://");
    h = h.replace(/^https?:\/\/open\.music\.apple\.com/i, "https://music.apple.com");
    h = h.replace(/^https?:\/\/embed\.music\.apple\.com/i, "https://music.apple.com");
    h = h.replace(/^\/\/music\.apple\.com/i, "https://music.apple.com");
    return h;
  }
  function buildFallback(title, artist){
    var q = encodeURIComponent((title + " " + (artist||"")).trim());
    return "https://music.apple.com/us/search?term=" + q;
  }
  function currentSong(){
    try{
      if (!window.app || !Array.isArray(window.songs)) return null;
      return window.songs[window.app.i] || null;
    }catch(_){ return null; }
  }
  function appleHrefFor(song){
    if (!song) return null;
    var href = (song.links && song.links.apple) ? song.links.apple : buildFallback(song.title, song.alias);
    return norm(href);
  }

  function setupIOS(){
    // Show and wire floating button (already injected in fix24), hide in-card link
    var wrap = document.getElementById('floating-apple-wrap');
    var btn = document.getElementById('floating-apple-btn');
    if (wrap) wrap.style.display = 'flex';
    var s = currentSong();
    var href = appleHrefFor(s);
    if (btn && href){
      btn.href = href;
      btn.target = '_self';
      btn.rel = 'external';
      btn.onclick = function(){ window.location.href = href; };
      btn.textContent = " Apple Music — " + ((s && s.title) ? s.title : "track");
    }
    var btns = document.getElementById('btns');
    if (btns){
      var appleA = Array.from(btns.querySelectorAll('a')).find(a => /Apple Music/i.test(a.textContent||""));
      if (appleA){
        appleA.style.opacity = '0.25';
        appleA.style.pointerEvents = 'none';
        appleA.title = "Use the Apple button at the bottom on iPad";
      }
    }
  }

  function setupDesktop(){
    // Hide floating button, restore in-card link to open in new tab
    var wrap = document.getElementById('floating-apple-wrap');
    if (wrap) wrap.style.display = 'none';
    var btns = document.getElementById('btns');
    if (btns){
      var appleA = Array.from(btns.querySelectorAll('a')).find(a => /Apple Music/i.test(a.textContent||""));
      if (appleA){
        var href = appleHrefFor(currentSong()) || appleA.getAttribute('href') || "";
        href = norm(href);
        appleA.setAttribute('href', href);
        appleA.setAttribute('target','_blank');
        appleA.setAttribute('rel','noopener');
        appleA.onclick = null;
        appleA.style.opacity = '';
        appleA.style.pointerEvents = 'auto';
        appleA.title = "";
      }
    }
  }

  function apply(){
    if (isIOS()) setupIOS(); else setupDesktop();
  }

  if (window.app && typeof app.render === 'function'){
    var _r = app.render.bind(app);
    app.render = function(){ _r(); apply(); };
    setTimeout(apply, 0);
  } else {
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(apply, 50); });
  }
})();
/* --- end device-specific behavior --- */
</script>

<script>
(function(){
  function isIOS(){
    var ua = navigator.userAgent || navigator.vendor || "";
    return /iPad|iPhone|iPod/.test(ua) || (ua.includes("Mac") && 'ontouchend' in document);
  }
  function apply(){
    var wrap = document.getElementById('floating-apple-wrap');
    if (!wrap) return;
    if (isIOS()){
      wrap.style.display = 'flex';
      wrap.style.pointerEvents = 'auto';
    } else {
      wrap.style.display = 'none';
      wrap.style.pointerEvents = 'none';
    }
  }
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', function(){ setTimeout(apply, 50); });
  } else {
    setTimeout(apply, 0);
  }
})();
</script>


<script>
document.addEventListener('DOMContentLoaded', function(){ try{
  if (!Array.isArray(window.songs)) return;
  function setLink(title, provider, url){
    var t = (title||"").toLowerCase().trim();
    for (var i=0;i<songs.length;i++){
      var s = songs[i] || {};
      var st = ((s.title)||"").toLowerCase().trim();
      if (st === t){
        s.links = s.links || {};
        s.links[provider] = url;
        break;
      }
    }
  }
  setLink("Morning Bloom", "apple", "https://music.apple.com/us/album/morning-bloom/1840199864?i=1840199865");
} catch(e){} }, {once:true});
</script>


<script>
document.addEventListener('DOMContentLoaded', function(){
  try {
    var prev = document.getElementById('prev');
    if (prev) {
      // simulate one left-click after initial render
      setTimeout(function(){ prev.click(); }, 2000);
    }
  } catch(e){}
});
</script>


<script>
document.addEventListener('DOMContentLoaded', function(){
  try {
    var header = document.querySelector('header h1');
    if (header) {
      header.style.cursor = 'pointer'; // make it feel clickable
      header.title = "Click to jump to a random song";

      header.addEventListener('click', function(){
        if (!window.app || !Array.isArray(window.songs)) return;

        // Exclude the "All Songs" page
        var validIndexes = window.songs
          .map((s, i) => s.__all_page__ ? null : i)
          .filter(i => i !== null);

        if (validIndexes.length > 0) {
          var r = Math.floor(Math.random() * validIndexes.length);
          app.i = validIndexes[r];
          app.render();
        }
      });
    }
  } catch(e){}
});
</script>


<script>
document.addEventListener('DOMContentLoaded', function(){
  try {
    var header = document.querySelector('header h1');
    if (!header) return;

    function jumpRandom(){
      try {
        if (!window.app || !window.songs || !window.songs.length) return;
        var valid = [];
        for (var i = 0; i < window.songs.length; i++){
          var s = window.songs[i] || {};
          if (!s.__all_page__) valid.push(i);
        }
        if (!valid.length) return;
        var r = Math.floor(Math.random() * valid.length);
        window.app.i = valid[r];
        window.app.render();
        if (typeof window.preloadNeighbors === 'function'){ window.preloadNeighbors(window.app.i); }
      } catch (_){}
    }

    // Make it feel interactive + accessible
    header.style.cursor = 'pointer';
    header.setAttribute('role','button');
    header.setAttribute('tabindex','0');
    header.title = "Random track — tap me";

    // Click
    header.addEventListener('click', function(e){
      try { e.stopPropagation(); } catch (_){}
      jumpRandom();
    }, false);

    // Touch (iPad/iOS): trigger immediately and prevent ghost click
    header.addEventListener('touchend', function(e){
      try { e.preventDefault(); } catch(_){}
      try { e.stopPropagation(); } catch(_){}
      jumpRandom();
    }, false);

    // Keyboard
    header.addEventListener('keydown', function(e){
      var k = e.key || e.code || '';
      if (k === 'Enter' || k === ' ' || k === 'Spacebar'){
        try { e.preventDefault(); } catch(_){}
        jumpRandom();
      }
    }, false);
  } catch(e){}
});
</script>


<script>
document.addEventListener('DOMContentLoaded', function(){
  try {
    var artImg = document.querySelector('.art img');
    if (!artImg) return;

    function jumpRandom(){
      try {
        if (!window.app || !window.songs || !window.songs.length) return;
        var valid = [];
        for (var i = 0; i < window.songs.length; i++){
          var s = window.songs[i] || {};
          if (!s.__all_page__) valid.push(i);
        }
        if (!valid.length) return;
        var r = Math.floor(Math.random() * valid.length);
        window.app.i = valid[r];
        window.app.render();
        if (typeof window.preloadNeighbors === 'function'){ window.preloadNeighbors(window.app.i); }
      } catch (_){}
    }

    artImg.style.cursor = 'pointer';
    artImg.title = "Tap artwork for a random track";

    // Click
    artImg.addEventListener('click', function(e){
      try { e.stopPropagation(); } catch (_){}
      jumpRandom();
    }, false);

    // Touch (iPad/iOS)
    artImg.addEventListener('touchend', function(e){
      try { e.preventDefault(); } catch(_){}
      try { e.stopPropagation(); } catch(_){}
      jumpRandom();
    }, false);
  } catch(e){}
});
</script>

</body>
</html>
